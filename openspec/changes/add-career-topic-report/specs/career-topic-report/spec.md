# career-topic-report Specification

## Purpose
事业/学业专题深度解读报告，从职业天赋、职场人际、人生使命、未来运势四个维度为用户提供 2600-3500 字的深度职业分析，特别融入中国职场文化（体制、考公、副业等）。

## ADDED Requirements

### Requirement: 事业专题报告生成

系统 SHALL 支持基于用户本命盘和行运数据生成事业专题深度解读报告（reportType: `career-topic`）。

报告 SHALL 包含以下 4 个模块：
- 职业天赋地图（talent）：900-1200 字
- 职场人际与领导力（workplace）：500-700 字
- 人生使命与长期方向（mission）：600-800 字
- 未来12个月事业运势（forecast）：600-800 字

报告总字数 SHALL 在 2600-3500 字范围。

#### Scenario: 用户请求生成事业专题报告
- **GIVEN** 用户已完成付费
- **AND** 用户本命盘数据已存在
- **WHEN** 用户请求生成事业专题报告
- **THEN** 系统按 3 个批次启动模块生成

#### Scenario: 学生用户场景
- **GIVEN** 用户为学生或备考阶段
- **WHEN** forecast 模块生成
- **THEN** 输出 SHALL 包含学习效率、考试运势等学生相关内容

---

### Requirement: 事业相关星盘数据提取

系统 SHALL 从用户本命盘中提取以下事业相关核心数据：

**本命数据**：
- MC（中天）：星座、度数、相位
- 第10宫：宫头星座、落入行星、宫主星位置
- 第6宫：宫头星座、落入行星、宫主星位置
- 第2宫：宫头星座（赚钱方式关联）
- 土星：星座、宫位、所有相位
- 木星：星座、宫位（机遇方向）
- 太阳：宫位（核心身份展现）
- 火星：星座、宫位（行动力驱动）
- 水星：星座、宫位（思维技能）
- 北交点：星座、宫位（灵魂使命方向）

**行运数据（未来12个月）**：
- 外行星过境10宫/6宫/2宫
- 行运土星与本命MC/太阳的相位
- 行运木星与事业宫位的互动
- 水星逆行落入的宫位

#### Scenario: 完整数据提取
- **GIVEN** 用户本命盘数据包含完整出生信息
- **WHEN** 系统启动事业专题报告生成
- **THEN** 系统提取 MC、10/6/2宫、土星、木星等数据
- **AND** 计算未来12个月事业相关行运

---

### Requirement: 分批并行生成策略

系统 SHALL 按以下 3 个批次生成事业专题模块：

- 批次 1（立即）：talent
- 批次 2（批次 1 完成后并行）：workplace, mission
- 批次 3（批次 2 完成后）：forecast

#### Scenario: 分批生成顺序
- **GIVEN** 用户请求生成报告
- **WHEN** talent 完成
- **THEN** 立即启动 workplace 和 mission 的并行生成

---

### Requirement: 中国职场文化特化

talent 模块 SHALL 包含以下中国特色分析维度：
- 体制内/体制外/自由职业适配度
- 考公/考研/考编场景解读
- 副业方向建议
- 大公司/小团队/独立工作的适配分析

系统 SHALL 不做绝对判断，而是分析不同选择下用户的优势和需要适应的部分。

#### Scenario: 体制适配度分析
- **GIVEN** 用户土星与10宫有强相位
- **WHEN** talent 模块生成
- **THEN** 输出 SHALL 包含对"体制内"适配度的分析
- **AND** 同时提供"体制外"选择下的优势分析

---

### Requirement: 质量校验

系统 SHALL 对事业专题报告的每个模块进行自动质量校验：

- talent：字数 900-1200，关键词 ['职业|事业', 'MC|中天|10宫|十宫'] 至少命中 2 个
- workplace：字数 500-700，关键词 ['团队|同事|领导', '职场'] 至少命中 1 个
- mission：字数 600-800，关键词 ['使命|方向', '北交|成长'] 至少命中 1 个
- forecast：字数 600-800，关键词 ['行运|过境', '事业|工作'] 至少命中 1 个

全局禁止词：`注定`, `劫难`, `你赚不到钱`, `你的盘很凶`

#### Scenario: 禁止词触发重试
- **GIVEN** 禁止词列表包含"你赚不到钱"
- **WHEN** talent 模块输出包含该词
- **THEN** 系统重新生成

---

### Requirement: 报告缓存

事业专题报告 SHALL 使用以下缓存策略：
- 任务记录 TTL：7 天
- 报告内容 TTL：60 天

#### Scenario: 缓存命中
- **GIVEN** 用户之前已生成过事业专题报告且出生信息未变更
- **WHEN** 用户再次查看
- **THEN** 系统从缓存返回

---

### Requirement: 前端展示

report 页面 SHALL 支持 `career-topic` 报告类型，使用蓝紫色调模块色条（主色 #7B8CDE）。

"本我"页面专题入口区域中的事业卡片 SHALL 显示蓝紫色调。

#### Scenario: 从本我页面进入事业报告
- **GIVEN** 用户已购买事业专题报告
- **WHEN** 用户点击事业入口卡片
- **THEN** 跳转到 `/pages/report/report?reportType=career-topic`
