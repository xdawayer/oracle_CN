# Proposal: 新增月度运势深度解读付费报告

## 动机

当前产品的"今日运势"页面提供每日运势预测，但缺少月度维度的深度运势分析。月度运势是连接"日运"和"流年运势"之间的关键中间产品，也是付费生态中提升用户月度活跃和复购率的核心粘合剂。

中国占星用户对"新月许愿""满月复盘"等仪式性内容有强烈兴趣，月度报告能够自然承载这些高参与度内容。

## 目标

1. 在"今日运势"页面底部新增"月度运势深度解读"入口卡片
2. 复用现有通用报告框架（`report-task.ts`），新增 `monthly` 报告类型
3. 提供 6 个 AI 模块的并行生成，总字数 2800-3900 字
4. 支持月度推送运营体系（新月/满月提醒、月度预告等）
5. 整体交互体验与"本命深度解读"一致（入口卡片 → 付费 → 异步生成 → 渐进式展示）

## 报告结构

| 模块 | ID | 字数目标 | AI 调用 |
|------|----|----------|---------|
| 模块A：月度总基调 | `tone` | 300-400 字 | 1 次 |
| 模块B：分维度运势 | `dimensions` | 1000-1500 字 | 1 次 |
| 模块C：上中下旬节奏指南 | `rhythm` | 600-800 字 | 1 次 |
| 模块D：新月/满月指南 | `lunar` | 600-800 字 | 1 次 |
| 模块E：关键日期速查表 | `dates` | 表格为主 | 1 次 |
| 模块F：月度行动清单 | `actions` | 300-400 字 | 1 次 |

总计：2800-3900 字，阅读时间约 8-12 分钟。

## 分批生成策略

```
批次 1（立即）：tone
批次 2（批次 1 完成后并行）：dimensions, rhythm, lunar, dates
批次 3（批次 2 完成后）：actions（需要前序模块摘要）
```

## 数据依赖

月度报告需要以下数据，区别于本命报告的纯本命盘数据：

1. **用户本命盘数据**：出生信息、本命行星位置、宫位
2. **当月公共天象**：太阳/月亮/行星位置、新月/满月日期与度数、行星换座/逆行
3. **用户个人行运**：行运行星过境宫位、行运与本命行星的相位（含精确日期和容许度）
4. **新月/满月与个人盘关系**：新月/满月落入用户的宫位

后端需新增行运计算服务，基于现有星历计算引擎（`ephemeris.ts`）扩展。

## 入口设计

在"今日运势"页面底部（本周趋势区域之后）新增入口卡片：
- 卡片标题：「X月运势深度解读」
- 卡片描述：简短的当月能量概要（可从模块A的主题命名预览）
- 点击跳转到通用报告页面 `/pages/report/report?reportType=monthly`

## Prompt 设计

### 系统提示词（全局）

角色定义为"温暖务实的占星师"，月度报告风格定位为用户每月的「能量日历」和「行动指南」。

核心原则：
1. 实用优先——每个信息点翻译为"这个月我该怎么做"
2. 节奏感清晰——让用户知道月度快慢节奏
3. 轻量但不浅薄——基于真实行运数据
4. 情绪基调——开朗务实有陪伴感

语言风格针对中国大陆用户优化：
- 句子短、段落短、阅读门槛低
- 可用口语化表达（"说白了就是……""划重点"）
- 引用中国生活化场景（工作日/周末节奏、节假日等）
- emoji 辅助表达节奏（每模块最多 3-4 个）

### 各模块提示词

详见 design.md 中的完整 Prompt 设计。

## 运营推送体系

| 时间点 | 推送内容 | 条件 |
|--------|----------|------|
| 每月 1 日 0:00 | 「你的X月运势已生成」 | 订阅用户自动解锁；非订阅用户推送免费预览+付费解锁 |
| 新月当天 | 新月许愿提醒 | 已购买当月报告的用户 |
| 满月当天 | 满月复盘提醒 | 已购买当月报告的用户 |
| 月中重大天象 | 额外天象提醒（如水逆开始） | 已购买当月报告的用户 |
| 月末最后 3 天 | 「下月运势即将生成」预告 | 所有用户（引导复购/续订） |

## 产品联动

月度报告内嵌 3-5 个自然转化钩子：
- 事业运势 → 本命深度解读（事业天赋）
- 感情运势 → 合盘报告
- 关键日期疑问 → AI 问答
- 新月许愿 → 本命盘报告（宫位解读）
- 行动清单 → 流年运势 / 人生 K 线

## 缓存策略

- 任务记录 TTL：3 天（月度报告时效性强）
- 报告内容 TTL：30 天（当月有效）
- 缓存 key：`report:monthly:{userId}:{moduleId}:{yearMonth}:{chartHash}`

## 范围

### 包含
- 后端：月度报告配置（`monthly-task.ts`）、行运数据包构建、6 个 Prompt 模板
- 前端：日运页面底部入口卡片、报告页面新增 `monthly` 类型配置
- API：在通用报告注册表中注册 `monthly` 类型

### 不包含
- 运营推送系统实现（另开提案，本次仅预留推送钩子）
- 订阅付费模式（复用现有单次付费流程）
- 行运计算引擎重构（复用现有 `ephemeris.ts`）

## 风险

1. **行运数据准确性**：月度报告依赖精确的行运日期，需确保星历计算的日期精度
2. **内容差异化**：不同用户的月报需有足够差异度，避免模板化
3. **Prompt Token 消耗**：月度报告数据包较大（公共天象 + 个人行运），需控制 token 用量

## 验收标准

1. 首模块 30s 内返回，全部 6 模块 2 分钟内完成
2. 报告总字数 2800-3900 字
3. 质量校验通过率 > 90%（首次生成）
4. 不同用户的同月报告差异度 > 60%（通过行运个性化保证）
