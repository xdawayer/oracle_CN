# 能力增量：合规与法律文档

## ADDED Requirements

### Requirement: 隐私保护声明配置

在 app.json 中添加 `__private_config__` 隐私收集清单，声明小程序收集的所有用户数据类型。

#### Scenario: 首次打开触发隐私授权弹窗

**Given** 用户首次打开小程序且未授权隐私协议
**When** 小程序加载完成
**Then** 弹出隐私授权弹窗，显示收集数据说明和《隐私政策》链接
**And** 用户同意后方可正常使用

#### Scenario: 隐私弹窗包含必要信息

**Given** 隐私授权弹窗展示
**When** 用户查看弹窗内容
**Then** 弹窗包含：应用名称、收集数据类型摘要、《隐私政策》可点击链接、"同意"和"拒绝"按钮

#### Scenario: 拒绝隐私授权后的处理

**Given** 用户在隐私弹窗点击"拒绝"
**When** 弹窗关闭
**Then** 提示用户需同意隐私协议才能使用，并保留再次弹出的机制

---

### Requirement: 隐私政策页面

提供完整的隐私政策内容页面，说明数据收集、使用、存储和保护方式。

#### Scenario: 从隐私弹窗跳转查看

**Given** 隐私授权弹窗展示
**When** 用户点击"隐私政策"链接
**Then** 跳转到隐私政策详情页面，显示完整隐私政策内容

#### Scenario: 隐私政策内容覆盖要求

**Given** 隐私政策页面打开
**When** 用户阅读内容
**Then** 内容包含以下章节：
- 信息收集范围（出生信息、设备信息、微信 OpenID）
- 信息使用目的（星盘计算、个性化内容生成）
- 信息存储与保护措施
- 第三方服务（DeepSeek AI、微信支付）
- 用户权利（查看、删除、注销）
- 联系方式

---

### Requirement: 用户服务协议页面

提供完整的用户服务协议，明确服务内容、用户行为规范和免责声明。

#### Scenario: 从引导页和我的页面可访问

**Given** 用户在引导页或我的页面
**When** 用户点击"用户协议"链接
**Then** 跳转到用户服务协议详情页面

#### Scenario: 用户协议内容覆盖要求

**Given** 用户协议页面打开
**When** 用户阅读内容
**Then** 内容包含以下章节：
- 服务说明（占星分析、AI 内容生成为娱乐参考，非专业建议）
- 用户行为规范
- 知识产权声明
- 免责声明（占星内容仅供参考）
- 服务变更与终止
- 争议解决

---

### Requirement: 会员服务协议页面

为 VIP 订阅提供专门的会员服务协议。

#### Scenario: 从订阅页面可访问

**Given** 用户在 VIP 订阅页面
**When** 用户点击"会员服务协议"文字
**Then** 跳转到会员服务协议详情页面

#### Scenario: 会员协议内容覆盖要求

**Given** 会员服务协议页面打开
**When** 用户阅读内容
**Then** 内容包含：会员权益说明、自动续费说明（如有）、退款政策、价格变更通知机制

---

### Requirement: 积分服务协议页面

为积分充值提供专门的积分服务协议。

#### Scenario: 从积分充值页面可访问

**Given** 用户在积分充值页面
**When** 用户点击"积分服务协议"文字
**Then** 跳转到积分服务协议详情页面

#### Scenario: 积分协议内容覆盖要求

**Given** 积分服务协议页面打开
**When** 用户阅读内容
**Then** 内容包含：积分获取与消耗规则、积分有效期、退款规则、积分不可转让声明

---

### Requirement: 账号注销功能

用户可以在「我的」页面发起账号注销。

#### Scenario: 注销入口可见

**Given** 用户已登录
**When** 用户进入「我的」页面
**Then** 页面底部或设置中可见"注销账号"入口

#### Scenario: 注销二次确认

**Given** 用户点击"注销账号"
**When** 确认弹窗展示
**Then** 弹窗说明注销后果（数据清除、VIP 失效、积分清零）
**And** 需要用户输入"确认注销"才能继续

#### Scenario: 注销成功处理

**Given** 用户完成二次确认
**When** 后端注销成功
**Then** 清除本地所有缓存和 token
**And** 跳转到引导页
**And** 后端标记账号为已删除（软删除，30 天后彻底清除）

---

### Requirement: 微信内容安全审核

AI 生成内容需通过微信内容安全 API 审核。

#### Scenario: AI 输出文本安全检查

**Given** 后端生成 AI 占星内容
**When** 内容生成完毕
**Then** 调用 `security.msgSecCheck` 进行文本安全检查
**And** 安全通过后返回前端，不通过则返回通用提示

#### Scenario: 占星敏感词过滤

**Given** AI 生成的占星内容
**When** 内容包含"算命""预测未来""迷信"等敏感词
**Then** 自动替换为合规表述（如"星象参考""趋势分析""文化解读"）

---

### Requirement: sitemap.json 安全配置

限制搜索引擎索引范围，保护用户隐私页面。

#### Scenario: 敏感页面不被索引

**Given** sitemap.json 配置
**When** 微信爬虫访问
**Then** 以下页面被禁止索引：me、subscription、points、points-history、profile、agreement
**And** 公开内容页面（home、discovery、wiki）允许索引
