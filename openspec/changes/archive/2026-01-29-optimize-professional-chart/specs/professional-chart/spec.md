# 专业排盘功能规范

## ADDED Requirements

### Requirement: 星盘可视化显示
专业排盘结果页面 SHALL 根据盘型显示对应的星盘可视化组件。

- 单人盘（natal/transit/推运盘）MUST 使用单轮盘显示
- 双人盘（synastry/composite/davison）MUST 使用双轮盘显示
- 星盘组件 MUST 使用现有 `<astro-chart>` 组件

#### Scenario: 用户生成本命盘
- Given 用户选择「本命盘」盘型
- And 用户填写完整的出生信息
- When 用户点击「生成专业星盘」
- Then 页面显示单轮盘星盘组件
- And 星盘组件类型为 `natal`

#### Scenario: 用户生成合盘比较盘
- Given 用户选择「合盘-比较盘」盘型
- And 用户填写完整的甲乙双方出生信息
- When 用户点击「生成专业星盘」
- Then 页面显示双轮盘星盘组件
- And 星盘组件类型为 `synastry`
- And 内环显示甲方行星位置
- And 外环显示乙方行星位置

---

### Requirement: 用户可选择显示模块
用户在排盘前 SHALL 可通过勾选框选择要显示的数据模块。

- 可选模块 MUST 包括：相位矩阵、行星信息、小行星信息、宫主星信息、元素信息
- 元素信息选项 MUST 仅在单人盘时可见
- 星盘可视化 MUST 为必选，不可取消

#### Scenario: 用户选择显示模块
- Given 用户在排盘表单页面
- And 用户勾选「相位矩阵」和「行星信息」
- And 用户取消勾选「小行星信息」
- When 用户点击「生成专业星盘」
- Then 结果页面显示相位矩阵折叠面板
- And 结果页面显示行星信息折叠面板
- And 结果页面不显示小行星信息折叠面板

#### Scenario: 双人盘隐藏元素信息选项
- Given 用户选择「合盘-比较盘」盘型
- Then 「元素信息」勾选框不可见
- And 结果页面不显示元素矩阵模块

---

### Requirement: 元素矩阵展示
单人盘结果页面 SHALL 展示元素矩阵，显示行星在四元素和三模式中的分布。

- 四元素 MUST 包括：火、土、风、水
- 三模式 MUST 包括：开创、固定、变动
- MUST 仅显示主要行星（日月水金火木土天海冥）
- 样式 MUST 参考「本我」页面的元素矩阵

#### Scenario: 本命盘显示元素矩阵
- Given 用户生成了本命盘
- And 用户勾选了「元素信息」
- When 结果页面加载完成
- Then 显示元素矩阵折叠面板
- And 矩阵按火/土/风/水行、开创/固定/变动列排列
- And 每个单元格显示对应位置的行星符号

---

### Requirement: 相位矩阵展示
结果页面 SHALL 展示相位矩阵，显示行星间的相位关系。

- 单人盘 MUST 使用三角矩阵，显示主要行星间的相位
- 双人盘 MUST 使用矩形矩阵，显示甲乙双方行星的跨盘相位
- 相位符号和颜色 MUST 参考现有配置

#### Scenario: 本命盘相位矩阵
- Given 用户生成了本命盘
- And 用户勾选了「相位矩阵」
- When 结果页面加载完成
- Then 显示三角形相位矩阵
- And 矩阵包含日月水金火木土天海冥及北交、ASC、MC
- And 相位单元格显示相位符号和容许度

#### Scenario: 合盘相位矩阵
- Given 用户生成了合盘比较盘
- And 用户勾选了「相位矩阵」
- When 结果页面加载完成
- Then 显示矩形跨盘相位矩阵
- And 行标题为乙方行星
- And 列标题为甲方行星

---

### Requirement: 行星信息表格展示
结果页面 SHALL 展示行星信息表格，包含星体、星座、宫位和逆行状态。

- MUST 显示 14 个主要星体：日月水金火木土天海冥 + ASC/MC/DSC/IC
- 表格列 MUST 包含：星体符号、星体名称、星座图标、星座名称、度数、宫位、逆行标识
- 样式 MUST 参考「本我」页面的行星信息表格

#### Scenario: 显示行星信息
- Given 用户生成了本命盘
- And 用户勾选了「行星信息」
- When 结果页面加载完成
- Then 显示行星信息折叠面板
- And 表格包含太阳到冥王星及四轴点
- And 逆行行星显示红色 R 标识

---

### Requirement: 小行星信息表格展示
结果页面 SHALL 展示小行星信息表格，结构同行星信息。

- MUST 显示：凯龙、谷神、智神、婚神、灶神、北交、南交、莉莉丝、福点、宿命点、东方点
- 样式 MUST 与行星信息表格一致

#### Scenario: 显示小行星信息
- Given 用户生成了本命盘
- And 用户勾选了「小行星信息」
- When 结果页面加载完成
- Then 显示小行星信息折叠面板
- And 表格包含凯龙等小行星

---

### Requirement: 宫主星信息表格展示
结果页面 SHALL 展示宫主星信息表格，显示 12 个宫位的宫主星飞入信息。

- 表格列 MUST 包含：宫位号、宫头星座、宫主星、飞入宫位
- 样式 MUST 参考「本我」页面的宫主星表格

#### Scenario: 显示宫主星信息
- Given 用户生成了本命盘
- And 用户勾选了「宫主星信息」
- When 结果页面加载完成
- Then 显示宫主星信息折叠面板
- And 表格包含 12 行（1-12 宫）
- And 每行显示宫头星座和宫主星飞入位置

---

### Requirement: 折叠面板交互
所有数据模块 SHALL 使用折叠面板形式展示，用户可点击展开/收起。

- 默认状态 MUST 为全部收起
- 点击面板标题行 MUST 切换展开/收起
- 展开时 MUST 显示完整内容
- 收起时 MUST 仅显示标题

#### Scenario: 展开折叠面板
- Given 用户在结果页面
- And 相位矩阵面板处于收起状态
- When 用户点击「相位矩阵」标题行
- Then 相位矩阵面板展开
- And 显示完整的相位矩阵内容

#### Scenario: 收起折叠面板
- Given 用户在结果页面
- And 相位矩阵面板处于展开状态
- When 用户点击「相位矩阵」标题行
- Then 相位矩阵面板收起
- And 仅显示「相位矩阵」标题

---

## MODIFIED Requirements

### Requirement: 移除查看详情按钮
结果页面的数据模块 SHALL 不再显示「查看详情」按钮，仅展示纯数据。

- 之前：各模块有「查看详情」按钮跳转到 AI 解读
- 现在：MUST 纯数据展示，无跳转

#### Scenario: 数据模块无详情按钮
- Given 用户在结果页面
- When 查看任意数据模块
- Then 模块内没有「查看详情」按钮
- And 模块内没有任何跳转链接

---

### Requirement: 结果页面布局调整
系统 SHALL 调整结果页面布局，星盘可视化置于顶部，数据模块置于下方。

- 顶部 MUST 为星盘可视化组件
- 下方 MUST 为折叠面板形式的数据模块

#### Scenario: 结果页面布局
- Given 用户生成了排盘
- When 结果页面加载完成
- Then 星盘可视化组件位于页面顶部
- And 折叠面板位于星盘下方
- And 各模块按元素矩阵、相位矩阵、行星信息、小行星信息、宫主星信息顺序排列
