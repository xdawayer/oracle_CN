<view class="container">
  <!-- Header -->
  <view class="header">
    <view class="back-btn" bindtap="onBack">
      <text class="back-text">返回</text>
    </view>
    <view class="header-title-group">
      <text class="header-title">{{selectedReport ? (selectedReport.content.title || selectedReport.title) : '收藏报告'}}</text>
      <text class="header-subtitle" wx:if="{{!selectedReport}}">我的档案</text>
    </view>
    <view class="header-placeholder"></view>
  </view>

  <!-- List View -->
  <view class="list-container" wx:if="{{!selectedReport}}">
    <view wx:if="{{reports.length === 0 && !loading}}" class="empty-state">
      <text class="empty-text">暂无已收藏的报告</text>
      <text class="empty-subtext">去探索页面生成你的第一份专业解析吧</text>
    </view>

    <view wx:for="{{reports}}" wx:key="id" class="report-card" bindtap="onSelectReport" data-report="{{item}}">
      <view class="card-header">
        <view class="tag {{item.typeClass}}">
          {{item.typeText}}
        </view>
        <view class="date-label">
          {{item.dateFormatted}}
        </view>
      </view>
      <view class="card-title">{{item.title}}</view>
      <view class="card-summary">{{item.summary}}</view>
      <view class="card-footer">
        <text class="details-link">点击查看详情</text>
      </view>
    </view>
  </view>

  <!-- Detail View -->
  <scroll-view scroll-y class="detail-container" wx:else>
    <view class="detail-meta">
      <view class="tag {{selectedReport.typeClass}}">
        {{selectedReport.typeText}}
      </view>
      <view class="detail-date">{{selectedReport.date}} 生成</view>
    </view>

    <!-- Generic Content Structure -->
    <view class="report-header-section">
      <text class="report-main-title">{{selectedReport.content.title}}</text>
      <text class="report-subtitle" wx:if="{{selectedReport.content.subtitle}}">{{selectedReport.content.subtitle}}</text>
      <view class="report-summary-box" wx:if="{{selectedReport.content.summary}}">
        <text class="summary-text">{{selectedReport.content.summary}}</text>
      </view>
    </view>

    <block wx:for="{{selectedReport.content.sections}}" wx:key="title">
       <view class="section-card">
         <view class="section-title">
           <text>{{item.title}}</text>
           <text class="section-rating" wx:if="{{item.rating}}">评分: {{item.rating}}</text>
         </view>
         
         <view class="section-content" wx:if="{{item.content}}">
           <text>{{item.content}}</text>
         </view>

          <view class="highlights-box" wx:if="{{item.highlights && item.highlights.length > 0}}">
             <view class="highlight-item" wx:for="{{item.highlights}}" wx:for-item="hl" wx:key="*this">
                <text>{{hl}}</text>
             </view>
          </view>

          <view class="advice-box" wx:if="{{item.advice}}">
             <text class="advice-label">建议</text>
             <text class="advice-content">{{item.advice}}</text>
          </view>
       </view>
    </block>

    <!-- Footer Security -->
    <view class="security-footer">
      <text class="security-text text-success">安全</text>
      <text class="security-text">此报告已在本地加密并上云，仅您本人可查看。</text>
    </view>
    
    <view style="height: 40rpx;"></view>
  </scroll-view>
</view>
