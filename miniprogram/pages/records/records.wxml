<view class="container">
  <!-- 列表 -->
  <scroll-view scroll-y class="record-list" show-scrollbar="false">
    <block wx:if="{{records.length > 0}}">
      <view
        class="record-card ink-border"
        wx:for="{{records}}"
        wx:key="id"
        bindtap="onSelectRecord"
        data-id="{{item.id}}"
      >
        <view class="score-badge">
          <text class="score-value font-ancient">{{item.score}}</text>
          <text class="score-unit">PTS</text>
        </view>

        <view class="record-info">
          <view class="record-names">
            <text class="names-text">{{item.nameA}} & {{item.nameB}}</text>
            <view class="relation-tag" wx:if="{{item.relation}}">{{item.relation}}</view>
          </view>
          <text class="date-text">{{item.date}}</text>
        </view>

        <text class="record-chevron">></text>
      </view>
    </block>

    <!-- 空状态 -->
    <block wx:else>
      <view class="empty-state" wx:if="{{!loading}}">
        <text class="empty-title">尚无测算记录</text>
        <text class="empty-desc">快去"发现-关系分析"中测算你与对方的契合度，记录将自动保存至此。</text>
        <view class="empty-btn" bindtap="onGoToMatch">
          <text class="empty-btn-text">立即测算</text>
        </view>
      </view>
    </block>
  </scroll-view>

  <!-- 详情弹窗 -->
  <view class="modal-overlay {{selectedRecord ? 'active' : ''}}" wx:if="{{selectedRecord}}">
    <view class="modal-content">
      <view class="modal-header">
        <view class="close-btn" bindtap="onCloseDetail">
          <text>×</text>
        </view>
        <view class="modal-title-box">
          <text class="modal-title font-ancient">分析详情</text>
          <text class="modal-subtitle">{{selectedRecord.nameA}} & {{selectedRecord.nameB}}</text>
        </view>
        <view class="spacer"></view>
      </view>

      <scroll-view scroll-y class="modal-body" show-scrollbar="false">
        <!-- 分数头部 -->
        <view class="detail-score-card">
          <text class="detail-label">匹配指数</text>
          <text class="detail-score font-ancient">{{selectedRecord.result.overallScore}}%</text>
          <view class="detail-relation">
            <text>{{selectedRecord.relation}}</text>
          </view>
        </view>

        <!-- 维度 -->
        <view class="detail-section ink-border">
          <text class="section-title font-ancient">维度分布</text>
          <view class="dimensions-list">
            <view class="dimension-item">
              <view class="dim-header">
                <text>情感</text>
                <text>{{selectedRecord.result.dimensions.emotional}}%</text>
              </view>
              <view class="progress-bg">
                <view class="progress-bar" style="width: {{selectedRecord.result.dimensions.emotional}}%"></view>
              </view>
            </view>
            <view class="dimension-item">
              <view class="dim-header">
                <text>沟通</text>
                <text>{{selectedRecord.result.dimensions.communication}}%</text>
              </view>
              <view class="progress-bg">
                <view class="progress-bar" style="width: {{selectedRecord.result.dimensions.communication}}%"></view>
              </view>
            </view>
            <view class="dimension-item">
              <view class="dim-header">
                <text>激情</text>
                <text>{{selectedRecord.result.dimensions.passion}}%</text>
              </view>
              <view class="progress-bg">
                <view class="progress-bar" style="width: {{selectedRecord.result.dimensions.passion}}%"></view>
              </view>
            </view>
            <view class="dimension-item">
              <view class="dim-header">
                <text>稳定</text>
                <text>{{selectedRecord.result.dimensions.stability}}%</text>
              </view>
              <view class="progress-bg">
                <view class="progress-bar" style="width: {{selectedRecord.result.dimensions.stability}}%"></view>
              </view>
            </view>
            <view class="dimension-item">
              <view class="dim-header">
                <text>成长</text>
                <text>{{selectedRecord.result.dimensions.growth}}%</text>
              </view>
              <view class="progress-bg">
                <view class="progress-bar" style="width: {{selectedRecord.result.dimensions.growth}}%"></view>
              </view>
            </view>
          </view>
        </view>

        <!-- 综合解析 -->
        <view class="detail-section ink-border" wx:if="{{selectedRecord.result.overview}}">
          <text class="section-title font-ancient">综合解析</text>
          <text class="overview-text">"{{selectedRecord.result.overview}}"</text>
        </view>

        <!-- 章节循环 -->
        <view class="detail-section ink-border" wx:if="{{selectedRecord.result.sections.natalA}}">
          <text class="section-title font-ancient">{{selectedRecord.result.sections.natalA.title}}</text>
          <text class="section-content">{{selectedRecord.result.sections.natalA.content}}</text>
        </view>

        <view class="detail-section ink-border" wx:if="{{selectedRecord.result.sections.natalB}}">
          <text class="section-title font-ancient">{{selectedRecord.result.sections.natalB.title}}</text>
          <text class="section-content">{{selectedRecord.result.sections.natalB.content}}</text>
        </view>

        <view class="detail-section ink-border" wx:if="{{selectedRecord.result.sections.synastryAB}}">
          <text class="section-title font-ancient">{{selectedRecord.result.sections.synastryAB.title}}</text>
          <text class="section-content">{{selectedRecord.result.sections.synastryAB.content}}</text>
        </view>

        <view class="detail-section ink-border" wx:if="{{selectedRecord.result.sections.synastryBA}}">
          <text class="section-title font-ancient">{{selectedRecord.result.sections.synastryBA.title}}</text>
          <text class="section-content">{{selectedRecord.result.sections.synastryBA.content}}</text>
        </view>

        <view class="detail-section ink-border" wx:if="{{selectedRecord.result.sections.composite}}">
          <text class="section-title font-ancient">{{selectedRecord.result.sections.composite.title}}</text>
          <text class="section-content">{{selectedRecord.result.sections.composite.content}}</text>
        </view>

        <view class="detail-section ink-border" wx:if="{{selectedRecord.result.sections.davison}}">
          <text class="section-title font-ancient">{{selectedRecord.result.sections.davison.title}}</text>
          <text class="section-content">{{selectedRecord.result.sections.davison.content}}</text>
        </view>

        <view class="close-wrap">
          <view class="close-detail-btn" bindtap="onCloseDetail">
            <text>返回列表</text>
          </view>
        </view>
        <view style="height: 60rpx;"></view>
      </scroll-view>
    </view>
  </view>
</view>
