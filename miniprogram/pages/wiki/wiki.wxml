<view class="container">
  <!-- Header -->
  <view class="header">
    <view class="header-content">
      <view class="title-group">
        <text class="main-title font-ancient">占星百科</text>
        <text class="sub-title">UNIVERSAL KNOWLEDGE</text>
      </view>
    </view>
  </view>

  <!-- Categories -->
  <view class="categories-wrapper">
    <scroll-view scroll-x class="categories-scroll" enable-flex show-scrollbar="false">
      <view class="categories-list">
        <view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="category-item {{selectedCat === item.id ? 'active' : ''}}"
          bindtap="onSelectCategory"
          data-id="{{item.id}}"
        >
          <view class="cat-pill {{item.id}} ink-border">
            <text class="cat-name">{{item.name}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- Content Area -->
  <view class="content-area">
    <!-- Search -->
    <view class="search-bar ink-border">
      <input
        class="search-input"
        placeholder="搜索知识点..."
        placeholder-class="search-placeholder"
        value="{{searchQuery}}"
        bindinput="onSearchInput"
      />
      <text wx:if="{{searchQuery}}" class="clear-btn" bindtap="onClearSearch">清除</text>
    </view>

    <!-- List -->
    <scroll-view scroll-y class="items-list" enable-flex show-scrollbar="false">
      <view wx:if="{{filteredItems.length === 0 && !isLoading}}" class="empty-state">
        <text class="empty-text">没有找到相关知识条目</text>
      </view>

      <view 
        wx:for="{{filteredItems}}" 
        wx:key="id" 
        class="wiki-card ink-border"
        bindtap="onSelectItem"
        data-item="{{item}}"
      >
        <view class="wiki-card-content">
          <view class="wiki-card-header">
            <view class="cat-tag {{item.type}} ink-border">
              <text>{{item.categoryName || item.category}}</text>
            </view>
            <text class="wiki-title">{{item.title}}</text>
          </view>
          <text class="wiki-summary">{{item.description}}</text>
        </view>
        <view class="arrow-icon">›</view>
      </view>
      
      <!-- Bottom spacing -->
      <view style="height: 40rpx;"></view>
    </scroll-view>
  </view>

  <!-- Detail Overlay (全屏覆盖层) -->
  <view class="wiki-detail-overlay" wx:if="{{selectedItem}}">
    <!-- 顶部栏 -->
    <view class="wiki-detail-topbar">
      <view class="wiki-detail-back" bindtap="onCloseDetail">
        <view class="wiki-detail-back-icon"></view>
      </view>
      <text class="wiki-detail-nav-title">{{selectedItem.categoryName || '详情'}}</text>
      <view class="wiki-detail-right-placeholder"></view>
    </view>

    <scroll-view scroll-y class="wiki-detail-scroll" show-scrollbar="false">
      <!-- 头部信息 -->
      <view class="wiki-detail-header">
        <view class="cat-tag {{selectedItem.type}} ink-border">
          <text>{{selectedItem.categoryName || selectedItem.category}}</text>
        </view>
        <text class="wiki-detail-title font-ancient">{{selectedItem.title}}</text>
        <text wx:if="{{selectedItem.subtitle}}" class="wiki-detail-subtitle">{{selectedItem.subtitle}}</text>
        <text wx:if="{{selectedItem.symbol}}" class="wiki-detail-symbol">{{selectedItem.symbol}}</text>
        <view wx:if="{{selectedItem.keywords && selectedItem.keywords.length}}" class="wiki-detail-keywords">
          <text wx:for="{{selectedItem.keywords}}" wx:key="*this" class="wiki-keyword-tag ink-border">{{item}}</text>
        </view>
      </view>

      <!-- 分段卡片 -->
      <view class="detail-card detail-card--{{item.cardColor || 'default'}}"
            wx:for="{{detailSections}}" wx:key="index">
        <view class="detail-card__accent"></view>
        <view class="detail-card__body">
          <text class="detail-card__title">{{item.title}}</text>
          <text class="detail-card__text" wx:if="{{item.text}}">{{item.text}}</text>
          <view class="detail-card__list" wx:if="{{item.list && item.list.length > 0}}">
            <view class="detail-card__list-item" wx:for="{{item.list}}" wx:for-item="listItem" wx:for-index="idx" wx:key="idx">
              <text class="detail-card__list-num">{{idx + 1}}.</text>
              <text class="detail-card__list-text">{{listItem}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 底部间距 -->
      <view style="height: 80rpx;"></view>
    </scroll-view>
  </view>
</view>
