<view class="page">
  <view class="header">
    <text class="title font-ancient">星缘速配</text>
    <text class="subtitle">探索你们的缘分密码</text>
  </view>

  <view class="content">

    <view class="selection-area">
      <view class="user-column">
        <text class="column-label">甲方</text>
        <view class="avatar-card ink-border">
          <image
            wx:if="{{!iconErrorA}}"
            class="zodiac-icon"
            src="/images/astro-symbols/{{zodiacSigns[signAIndex].id}}.png"
            mode="aspectFit"
            binderror="onIconErrorA"
          ></image>
          <text class="avatar-name font-ancient">{{zodiacSigns[signAIndex].name}}</text>
          <text class="avatar-animal">属{{animalSigns[animalAIndex]}}</text>
        </view>
        <view class="picker-group">
          <picker range="{{zodiacSigns}}" range-key="name" value="{{signAIndex}}" bindchange="bindSignAChange">
            <view class="picker-item ink-border">{{zodiacSigns[signAIndex].name}}</view>
          </picker>
          <picker range="{{animalSigns}}" value="{{animalAIndex}}" bindchange="bindAnimalAChange">
            <view class="picker-item ink-border">属{{animalSigns[animalAIndex]}}</view>
          </picker>
        </view>
      </view>

      <view class="center-decoration">
        <text class="heart-icon">❤️</text>
      </view>

      <view class="user-column">
        <text class="column-label">乙方</text>
        <view class="avatar-card ink-border">
          <image
            wx:if="{{!iconErrorB}}"
            class="zodiac-icon"
            src="/images/astro-symbols/{{zodiacSigns[signBIndex].id}}.png"
            mode="aspectFit"
            binderror="onIconErrorB"
          ></image>
          <text class="avatar-name font-ancient">{{zodiacSigns[signBIndex].name}}</text>
          <text class="avatar-animal">属{{animalSigns[animalBIndex]}}</text>
        </view>
        <view class="picker-group">
          <picker range="{{zodiacSigns}}" range-key="name" value="{{signBIndex}}" bindchange="bindSignBChange">
            <view class="picker-item ink-border">{{zodiacSigns[signBIndex].name}}</view>
          </picker>
          <picker range="{{animalSigns}}" value="{{animalBIndex}}" bindchange="bindAnimalBChange">
            <view class="picker-item ink-border">属{{animalSigns[animalBIndex]}}</view>
          </picker>
        </view>
      </view>
    </view>

    <button class="match-btn btn-primary" bindtap="handleMatch" disabled="{{loading}}">
      <block wx:if="{{loading}}">
        <text class="loading-text">正在测算...</text>
      </block>
      <block wx:else>
        <text>立即测算</text>
      </block>
    </button>

    <view class="info-card ink-border">
      <view class="info-content">
        <text class="info-title">深度分析</text>
        <text class="info-desc">融合东西方星象智慧，结合心理学深度模型，提供具有代入感的缘分洞察。</text>
      </view>
    </view>
  </view>

  <view class="overlay" wx:if="{{showResult}}">
    <view class="overlay-bg" bindtap="closeResult"></view>
    <view class="result-card ink-border">
      <view class="close-btn" bindtap="closeResult">×</view>
      
      <view class="result-heart-decoration">
        <text class="result-heart">❤️</text>
      </view>

      <view class="result-pairing-info">
        <view class="mini-avatar">
          <text class="mini-sign font-ancient">{{finalData.signA.name}}</text>
          <text class="mini-animal">属{{finalData.animalA}}</text>
        </view>
        <text class="pairing-connector">×</text>
        <view class="mini-avatar">
          <text class="mini-sign font-ancient">{{finalData.signB.name}}</text>
          <text class="mini-animal">属{{finalData.animalB}}</text>
        </view>
      </view>

      <view class="result-header">
        <text class="score-label font-ancient">缘分契合</text>
        <text class="score-value font-ancient">{{finalData.score}}%</text>
      </view>

      <view class="dimensions-grid">
        <view class="dim-item" wx:for="{{dimensionLabels}}" wx:key="key">
          <view class="dim-header">
            <text class="dim-label">{{item.label}}</text>
            <text class="dim-val font-ancient">{{finalData.dims[item.key]}}%</text>
          </view>
          <view class="progress-bar-wrap">
            <view class="progress-bar-inner" style="width: {{finalData.dims[item.key]}}%"></view>
          </view>
        </view>
      </view>

      <view class="analysis-box">
        <text class="analysis-text">“{{finalData.analysisText}}”</text>
      </view>

      <view class="tips-section">
        <view class="tip-box">
          <text class="tip-title font-ancient">相处指引</text>
          <text class="tip-text">在关键决策时多听听对方的直觉，尝试一起开启一段没有计划的旅行。</text>
        </view>
      </view>

      <button class="confirm-btn btn-primary" bindtap="closeResult">确认</button>
    </view>
  </view>
</view>
