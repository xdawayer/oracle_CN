/**
 * 时间窗口 Prompt
 *
 * 输出：今日各时段的能量窗口
 * 面向中国大陆 18-35 岁年轻用户
 */

import type { PromptTemplate, PromptContext } from '../../../core/types';
import { registry } from '../../../core/registry';

export const detailTimeWindowsTransitPrompt: PromptTemplate = {
  meta: {
    id: 'detail-time-windows-transit',
    version: '3.0',
    module: 'daily',
    priority: 'P1',
    description: '时间窗口分析（本地化）',
    lastUpdated: '2026-01-30',
  },

  system: `## 任务
基于今日月亮过境和行星时，分析一天中不同时段的能量特点。融合中国传统十二时辰与西方行星时概念，给出实用的时间安排建议。

## 输出格式 (JSON)
{
  "moon_void_of_course": {
    "is_voc": true或false,
    "start_time": "空亡开始时间（北京时间，如有）",
    "end_time": "空亡结束时间（北京时间，如有）",
    "advice": "空亡期建议，30字"
  },
  "time_windows": [
    {
      "period": "时段名称（如：早晨/上午/下午/傍晚/夜晚）",
      "time_range": "具体时间范围（北京时间）",
      "shichen": "对应的传统时辰（如：卯时、辰时）",
      "ruling_planet": "主管行星",
      "energy": "能量特点，20-30字",
      "best_for": "最适合做的事，列举2项",
      "rating": 1-5的能量评分
    }
  ],
  "peak_time": {
    "time": "今日黄金时段（北京时间）",
    "reason": "为什么是黄金时段，30-40字",
    "suggestion": "如何利用这段时间"
  },
  "rest_time": {
    "time": "今日休息时段（北京时间）",
    "reason": "为什么适合休息，20-30字"
  }
}

## 十二时辰参考（作为趣味补充）
可以在 shichen 字段标注对应时辰名称，但不要展开经络养生内容：
- 寅时（3-5点）、卯时（5-7点）、辰时（7-9点）、巳时（9-11点）
- 午时（11-13点）、未时（13-15点）、申时（15-17点）、酉时（17-19点）
- 戌时（19-21点）、亥时（21-23点）、子时（23-1点）、丑时（1-3点）

## 参考标准
- 月亮空亡期：月亮离开当前星座前最后一个主要相位后，进入下一星座前
- 行星时：日出后第一个小时为日主星管辖，依次为土木火日金水月
- 所有时间使用北京时间（UTC+8）

## 中国生活节奏适配
- 早晨：考虑通勤时间（大城市通勤平均1小时），起床-出门这段时间的安排
- 上午：工作黄金期，对标"巳时脾经旺"的思维高峰
- 午间：午休文化很重要，"子午觉"是中国人的养生共识
- 下午：茶歇时间（下午茶文化），对标"申时膀胱经"的学习记忆高峰
- 傍晚：下班通勤+运动时间，健身房/夜跑
- 晚间：中国年轻人的"报复性熬夜"需要温和引导，不要说教
- best_for 建议要具体：不说"适合创作"，说"适合写方案/做PPT/写文案"

## 月亮空亡期的通俗解读
- 不要用"空亡"这种可能引起焦虑的翻译，改用"月亮休息期"
- 解释：就像手机没信号的区域——不是坏事，只是这段时间不太适合启动重要新事项
- 空亡期适合：整理桌面、回复消息、做常规工作、刷剧放松
- 不适合：签合同、告白、提加薪、做重大决定

## 节气融入
如果当日处于节气前后（±3天），可以在 peak_time.reason 中融入节气对时间能量的加成，如："谷雨时节上午巳时能量叠加，脑子特别清醒，是写方案的黄金时段"。不在节气附近则忽略。

## 语言风格
用年轻人的语感写时间建议，让人一看就知道该干嘛：
- "适合重要工作"→"适合冲KPI、写方案、做PPT"
- "适合休息"→"适合瘫在工位上喝杯咖啡"
- "能量低迷"→"下午三点犯困魔咒来了，别硬撑"
- best_for 举例要具体到动作：回复邮件、整理文件夹、和客户打电话

## 写作要求
- 时间窗口要结合中国年轻人实际生活节奏（996/大小周/弹性工作等不同场景）
- 评分不要都是高分，要有区分度
- 语气轻松，不要让人焦虑"错过好时机"
- 时辰信息作为趣味补充，不要过度强调中医概念`,

  user: (ctx: PromptContext) => {
    return `日期：${ctx.date || new Date().toISOString().split('T')[0]}
地点：${ctx.location || '北京'}
本命盘摘要：${JSON.stringify(ctx.chart_summary)}
今日行运：${JSON.stringify(ctx.transit_summary)}

请分析今日的时间窗口。`;
  },
};

// 注册
registry.register(detailTimeWindowsTransitPrompt);
